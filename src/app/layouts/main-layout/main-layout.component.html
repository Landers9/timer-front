<!-- src/app/layouts/main-layout/main-layout.component.html -->

<!-- DESKTOP & TABLET: Sidebar + Content -->
<div class="hidden md:flex h-screen bg-gray-50">

  <!-- Sidebar -->
  <aside
    [class.w-60]="isSidebarOpen()"
    [class.w-16]="!isSidebarOpen()"
    class="fixed left-0 top-0 h-full bg-white border-r border-gray-200 transition-all duration-300 z-30 flex flex-col"
  >
    <!-- Logo -->
    <div class="h-16 flex items-center px-4 border-b border-gray-200 shrink-0">
      <ng-container *ngIf="isSidebarOpen()">
        <div class="flex items-center gap-2">
          <div class="w-7 h-7 bg-dark-900 rounded flex items-center justify-center">
            <span class="text-white font-bold text-sm">T</span>
          </div>
          <span class="font-semibold text-base text-dark-900">
            TASK<span class="text-primary-500">Y</span>
          </span>
        </div>
      </ng-container>
      <ng-container *ngIf="!isSidebarOpen()">
        <div class="w-7 h-7 bg-dark-900 rounded flex items-center justify-center mx-auto">
          <span class="text-white font-bold text-sm">T</span>
        </div>
      </ng-container>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
      <ng-container *ngFor="let item of menuItems()">
        <a
          [routerLink]="item.route"
          routerLinkActive="active"
          class="sidebar-item"
          [class.justify-center]="!isSidebarOpen()"
        >
          <lucide-angular [img]="item.icon" class="w-5 h-5 shrink-0"></lucide-angular>
          <span *ngIf="isSidebarOpen()" class="truncate">{{ item.label }}</span>
        </a>
      </ng-container>

      <div class="border-t border-gray-200 my-2"></div>

      <button
        (click)="logout()"
        class="sidebar-item w-full text-left hover:bg-red-50 hover:text-error transition-colors"
        [class.justify-center]="!isSidebarOpen()"
      >
        <lucide-angular [img]="LogOutIcon" class="w-5 h-5 shrink-0"></lucide-angular>
        <span *ngIf="isSidebarOpen()" class="truncate">Déconnexion</span>
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <div
    [class.ml-60]="isSidebarOpen()"
    [class.ml-16]="!isSidebarOpen()"
    class="flex-1 flex flex-col transition-all duration-300"
  >
    <!-- Header -->
    <header class="h-16 bg-white border-b border-gray-200 sticky top-0 z-20 shrink-0">
      <div class="h-full px-4 sm:px-6 flex items-center justify-between gap-4">
        <div class="flex items-center gap-3 min-w-0">
          <button (click)="toggleSidebar()" class="btn btn-icon shrink-0">
            <lucide-angular [img]="MenuIcon" class="w-5 h-5 text-dark-600"></lucide-angular>
          </button>
          <h1 class="text-xl font-semibold text-dark-900 truncate">Dashboard</h1>
        </div>

        <div class="flex items-center gap-2 sm:gap-3">
          <!-- Notifications -->
          <button class="btn btn-icon relative">
            <lucide-angular [img]="BellIcon" class="w-5 h-5 text-dark-600"></lucide-angular>
            <span *ngIf="notificationCount() > 0" class="absolute top-1 right-1 w-4 h-4 bg-error text-white text-[10px] font-bold rounded-full flex items-center justify-center">
              {{ notificationCount() > 9 ? "9+" : notificationCount() }}
            </span>
          </button>

          <!-- User Profile -->
          <ng-container *ngIf="authService.currentUser() as user">
            <div class="flex items-center gap-2 pl-2 sm:pl-3 border-l border-gray-200">
              <div class="text-right hidden lg:block">
                <p class="font-medium text-sm text-dark-900 leading-tight">
                  {{ user.firstName }} {{ user.lastName }}
                </p>
                <p class="text-xs text-gray-500 leading-tight">
                  {{ user.role === "manager" ? "Manager" : "Employé" }}
                </p>
              </div>
              <img
                [src]="'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=e5e7eb&color=1A1A1A&bold=true'"
                [alt]="user.firstName"
                class="w-9 h-9 rounded object-cover border border-gray-200"
              />
            </div>
          </ng-container>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="flex-1 p-4 sm:p-6 overflow-y-auto">
      <router-outlet></router-outlet>
    </main>
  </div>

</div>

<!-- MOBILE: Bottom Tab Navigation -->
<div class="md:hidden flex flex-col h-screen bg-gray-50">

  <!-- Header Mobile -->
  <header class="h-16 bg-white border-b border-gray-200 sticky top-0 z-20 shrink-0">
    <div class="h-full px-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-2">
        <div class="w-6 h-6 bg-dark-900 rounded flex items-center justify-center">
          <span class="text-white font-bold text-xs">T</span>
        </div>
        <span class="font-semibold text-sm text-dark-900">TASKY</span>
      </div>

      <div class="flex items-center gap-2">
        <button class="btn btn-icon relative">
          <lucide-angular [img]="BellIcon" class="w-5 h-5 text-dark-600"></lucide-angular>
          <span *ngIf="notificationCount() > 0" class="absolute top-1 right-1 w-3 h-3 bg-error text-white text-[8px] font-bold rounded-full flex items-center justify-center">
            {{ notificationCount() > 9 ? "9+" : notificationCount() }}
          </span>
        </button>

        <ng-container *ngIf="authService.currentUser() as user">
          <img
            [src]="'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=e5e7eb&color=1A1A1A&bold=true'"
            [alt]="user.firstName"
            class="w-8 h-8 rounded object-cover border border-gray-200"
          />
        </ng-container>
      </div>
    </div>
  </header>

  <!-- Content -->
  <main class="flex-1 overflow-y-auto pb-20">
    <router-outlet></router-outlet>
  </main>

  <!-- Bottom Tab Menu -->
  <nav class="fixed bottom-0 left-0 right-0 h-20 bg-white border-t border-gray-200 z-30">
    <div class="h-full flex items-center justify-around">

      <!-- Menu Button (Sidebar Overlay) -->
      <button
        (click)="openMobileSidebar()"
        class="flex flex-col items-center justify-center w-full h-full text-dark-600 hover:text-dark-900 hover:bg-gray-50 transition-colors"
      >
        <lucide-angular [img]="MenuIcon" class="w-6 h-6 mb-1"></lucide-angular>
        <span class="text-xs font-medium">Menu</span>
      </button>

      <!-- Users -->
      <a
        routerLink="/users"
        routerLinkActive="active"
        class="flex flex-col items-center justify-center w-full h-full text-dark-600 hover:text-dark-900 hover:bg-gray-50 transition-colors"
        [class.text-dark-900]="isRouteActive('/users')"
        [class.border-t-2]="isRouteActive('/users')"
        [class.border-dark-900]="isRouteActive('/users')"
      >
        <lucide-angular [img]="UsersTabIcon" class="w-6 h-6 mb-1"></lucide-angular>
        <span class="text-xs font-medium">Users</span>
      </a>

      <!-- Clock -->
      <a
        routerLink="/clock"
        routerLinkActive="active"
        class="flex flex-col items-center justify-center w-full h-full text-dark-600 hover:text-dark-900 hover:bg-gray-50 transition-colors"
        [class.text-dark-900]="isRouteActive('/clock')"
        [class.border-t-2]="isRouteActive('/clock')"
        [class.border-dark-900]="isRouteActive('/clock')"
      >
        <lucide-angular [img]="ClockTabIcon" class="w-6 h-6 mb-1"></lucide-angular>
        <span class="text-xs font-medium">Clock</span>
      </a>

      <!-- Teams -->
      <a
        routerLink="/teams"
        routerLinkActive="active"
        class="flex flex-col items-center justify-center w-full h-full text-dark-600 hover:text-dark-900 hover:bg-gray-50 transition-colors"
        [class.text-dark-900]="isRouteActive('/teams')"
        [class.border-t-2]="isRouteActive('/teams')"
        [class.border-dark-900]="isRouteActive('/teams')"
      >
        <lucide-angular [img]="TeamsTabIcon" class="w-6 h-6 mb-1"></lucide-angular>
        <span class="text-xs font-medium">Teams</span>
      </a>

      <!-- Profile -->
      <a
        routerLink="/profile"
        routerLinkActive="active"
        class="flex flex-col items-center justify-center w-full h-full text-dark-600 hover:text-dark-900 hover:bg-gray-50 transition-colors"
        [class.text-dark-900]="isRouteActive('/profile')"
        [class.border-t-2]="isRouteActive('/profile')"
        [class.border-dark-900]="isRouteActive('/profile')"
      >
        <lucide-angular [img]="ProfileTabIcon" class="w-6 h-6 mb-1"></lucide-angular>
        <span class="text-xs font-medium">Profile</span>
      </a>

    </div>
  </nav>

  <!-- Mobile Sidebar Overlay -->
  <div *ngIf="isMobileSidebarOpen()" class="fixed inset-0 z-40">
    <!-- Backdrop -->
    <div
      (click)="closeMobileSidebar()"
      class="absolute inset-0 bg-black bg-opacity-50 transition-opacity"
    ></div>

    <!-- Sidebar -->
    <aside class="absolute left-0 top-0 bottom-0 w-60 bg-white shadow-lg z-50 flex flex-col">

      <!-- Logo -->
      <div class="h-16 flex items-center px-4 border-b border-gray-200 shrink-0">
        <div class="flex items-center gap-2">
          <div class="w-7 h-7 bg-dark-900 rounded flex items-center justify-center">
            <span class="text-white font-bold text-sm">T</span>
          </div>
          <span class="font-semibold text-base text-dark-900">
            TASK<span class="text-primary-500">Y</span>
          </span>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
        <!-- Dashboard -->
        <a
          routerLink="/dashboard"
          (click)="closeMobileSidebar()"
          class="sidebar-item"
        >
          <lucide-angular [img]="DashboardIcon" class="w-5 h-5 shrink-0"></lucide-angular>
          <span class="truncate">Dashboard</span>
        </a>

        <!-- Reports -->
        <a
          routerLink="/reports"
          (click)="closeMobileSidebar()"
          class="sidebar-item"
        >
          <lucide-angular [img]="ReportsIcon" class="w-5 h-5 shrink-0"></lucide-angular>
          <span class="truncate">Reports</span>
        </a>

        <div class="border-t border-gray-200 my-2"></div>

        <!-- Logout -->
        <button
          (click)="logout()"
          class="sidebar-item w-full text-left hover:bg-red-50 hover:text-error transition-colors"
        >
          <lucide-angular [img]="LogOutIcon" class="w-5 h-5 shrink-0"></lucide-angular>
          <span class="truncate">Déconnexion</span>
        </button>
      </nav>
    </aside>

  </div>

</div>