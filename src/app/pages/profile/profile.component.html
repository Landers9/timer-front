<!-- src/app/pages/profile/profile.component.html -->

<div class="p-6 space-y-6">
  <!-- Header -->
  <div>
    <h1 class="text-2xl font-semibold text-dark-900">Mon profil</h1>
    <p class="text-sm text-dark-600 mt-1">
      Gérez vos informations personnelles et vos préférences
    </p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left Column: Profile Card -->
    <div class="lg:col-span-1 space-y-6">
      <!-- Profile Card -->
      <div class="bg-white rounded-lg border border-gray-200 p-6">
        <div class="flex flex-col items-center text-center">
          <!-- Avatar -->
          <img
            [src]="avatarUrl()"
            [alt]="fullName()"
            class="w-32 h-32 rounded-full border-4 border-primary-500 shadow-lg mb-4"
          />

          <!-- Name & Role -->
          <h2 class="text-xl font-bold text-dark-900">{{ fullName() }}</h2>
          <span [class]="'badge mt-2 ' + getRoleBadge(userProfile().role)">
            {{ getRoleLabel(userProfile().role) }}
          </span>

          <!-- Member Since -->
          <div class="mt-4 pt-4 border-t border-gray-200 w-full">
            <p class="text-xs text-dark-600 mb-1">Membre depuis</p>
            <p class="text-sm font-semibold text-dark-900">
              {{ formatJoinDate(userProfile().joinDate) }}
            </p>
            <p class="text-xs text-dark-600 mt-1">
              Il y a {{ memberSince() }} mois
            </p>
          </div>

          <!-- Actions -->
          <div class="mt-6 w-full space-y-2">
            <button
              *ngIf="!isEditMode()"
              (click)="enterEditMode()"
              class="btn-primary w-full"
            >
              <lucide-angular [img]="EditIcon" class="w-4 h-4"></lucide-angular>
              <span>Modifier le profil</span>
            </button>

            <button
              (click)="openPasswordModal()"
              class="btn-secondary w-full"
            >
              <lucide-angular [img]="LockIcon" class="w-4 h-4"></lucide-angular>
              <span>Changer le mot de passe</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="bg-white rounded-lg border border-gray-200 p-5">
        <h3 class="text-base font-semibold text-dark-900 mb-4">Statistiques</h3>

        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <span class="text-sm text-dark-600">Heures totales</span>
            <span class="text-sm font-bold text-dark-900">{{ stats().totalHours }}h</span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-dark-600">Moyenne/jour</span>
            <span class="text-sm font-bold text-dark-900">{{ stats().avgHoursPerDay }}h</span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-dark-600">Taux de présence</span>
            <span class="text-sm font-bold text-success">{{ stats().attendanceRate }}%</span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-dark-600">Jours travaillés</span>
            <span class="text-sm font-bold text-dark-900">{{ stats().daysWorked }}</span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-dark-600">Retards</span>
            <span
              [class.text-success]="stats().lateCount === 0"
              [class.text-warning]="stats().lateCount > 0 && stats().lateCount <= 5"
              [class.text-error]="stats().lateCount > 5"
              class="text-sm font-bold"
            >
              {{ stats().lateCount }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Profile Details & Activity -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Profile Information -->
      <div class="bg-white rounded-lg border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-dark-900">Informations personnelles</h3>

          <div *ngIf="isEditMode()" class="flex gap-2">
            <button (click)="cancelEdit()" class="btn-secondary">
              <lucide-angular [img]="XIcon" class="w-4 h-4"></lucide-angular>
              <span>Annuler</span>
            </button>
            <button (click)="saveProfile()" class="btn-primary">
              <lucide-angular [img]="SaveIcon" class="w-4 h-4"></lucide-angular>
              <span>Enregistrer</span>
            </button>
          </div>
        </div>

        <!-- View Mode -->
        <div *ngIf="!isEditMode()" class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-1">
            <label class="text-xs text-dark-600 font-medium flex items-center gap-2">
              <lucide-angular [img]="UserIcon" class="w-4 h-4"></lucide-angular>
              Prénom
            </label>
            <p class="text-sm text-dark-900 font-medium">{{ userProfile().firstName }}</p>
          </div>

          <div class="space-y-1">
            <label class="text-xs text-dark-600 font-medium flex items-center gap-2">
              <lucide-angular [img]="UserIcon" class="w-4 h-4"></lucide-angular>
              Nom
            </label>
            <p class="text-sm text-dark-900 font-medium">{{ userProfile().lastName }}</p>
          </div>

          <div class="space-y-1">
            <label class="text-xs text-dark-600 font-medium flex items-center gap-2">
              <lucide-angular [img]="MailIcon" class="w-4 h-4"></lucide-angular>
              Email
            </label>
            <p class="text-sm text-dark-900 font-medium">{{ userProfile().email }}</p>
          </div>

          <div class="space-y-1">
            <label class="text-xs text-dark-600 font-medium flex items-center gap-2">
              <lucide-angular [img]="PhoneIcon" class="w-4 h-4"></lucide-angular>
              Téléphone
            </label>
            <p class="text-sm text-dark-900 font-medium">{{ userProfile().phoneNumber }}</p>
          </div>

          <div class="space-y-1" *ngIf="userProfile().department">
            <label class="text-xs text-dark-600 font-medium flex items-center gap-2">
              <lucide-angular [img]="BriefcaseIcon" class="w-4 h-4"></lucide-angular>
              Département
            </label>
            <p class="text-sm text-dark-900 font-medium">{{ userProfile().department }}</p>
          </div>

          <div class="space-y-1" *ngIf="userProfile().position">
            <label class="text-xs text-dark-600 font-medium flex items-center gap-2">
              <lucide-angular [img]="BriefcaseIcon" class="w-4 h-4"></lucide-angular>
              Poste
            </label>
            <p class="text-sm text-dark-900 font-medium">{{ userProfile().position }}</p>
          </div>
        </div>

        <!-- Edit Mode -->
        <form *ngIf="isEditMode()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="input-label">Prénom</label>
            <input
              type="text"
              [(ngModel)]="formData().firstName"
              name="firstName"
              class="input-field"
            />
          </div>

          <div>
            <label class="input-label">Nom</label>
            <input
              type="text"
              [(ngModel)]="formData().lastName"
              name="lastName"
              class="input-field"
            />
          </div>

          <div>
            <label class="input-label">Email</label>
            <input
              type="email"
              [(ngModel)]="formData().email"
              name="email"
              class="input-field"
            />
          </div>

          <div>
            <label class="input-label">Téléphone</label>
            <input
              type="tel"
              [(ngModel)]="formData().phoneNumber"
              name="phoneNumber"
              class="input-field"
            />
          </div>

          <div>
            <label class="input-label">Département</label>
            <input
              type="text"
              [(ngModel)]="formData().department"
              name="department"
              class="input-field"
            />
          </div>

          <div>
            <label class="input-label">Poste</label>
            <input
              type="text"
              [(ngModel)]="formData().position"
              name="position"
              class="input-field"
            />
          </div>
        </form>
      </div>

      <!-- Recent Activity -->
      <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div class="p-5 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-dark-900 flex items-center gap-2">
            <lucide-angular [img]="ClockIcon" class="w-5 h-5"></lucide-angular>
            Activité récente
          </h3>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50 border-b border-gray-200">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-dark-600 uppercase">
                  Date
                </th>
                <th class="px-6 py-3 text-center text-xs font-semibold text-dark-600 uppercase">
                  Arrivée
                </th>
                <th class="px-6 py-3 text-center text-xs font-semibold text-dark-600 uppercase">
                  Départ
                </th>
                <th class="px-6 py-3 text-center text-xs font-semibold text-dark-600 uppercase">
                  Total
                </th>
                <th class="px-6 py-3 text-center text-xs font-semibold text-dark-600 uppercase">
                  Statut
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <tr *ngFor="let activity of recentActivities()" class="hover:bg-gray-50">
                <td class="px-6 py-4 text-sm text-dark-900 whitespace-nowrap">
                  {{ formatDate(activity.date) }}
                </td>
                <td class="px-6 py-4 text-sm text-dark-600 text-center whitespace-nowrap">
                  {{ activity.clockIn }}
                </td>
                <td class="px-6 py-4 text-sm text-dark-600 text-center whitespace-nowrap">
                  {{ activity.clockOut || '-' }}
                </td>
                <td class="px-6 py-4 text-sm font-medium text-dark-900 text-center whitespace-nowrap">
                  {{ activity.totalHours ? activity.totalHours + 'h' : '-' }}
                </td>
                <td class="px-6 py-4 text-center whitespace-nowrap">
                  <span [class]="'badge ' + getStatusBadgeClass(activity.status)">
                    {{ activity.status === 'completed' ? 'Terminé' : 'En cours' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div
  *ngIf="showPasswordModal()"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  (click)="closePasswordModal()"
>
  <div
    class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4"
    (click)="$event.stopPropagation()"
  >
    <div class="flex items-center justify-between p-6 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-dark-900">Changer le mot de passe</h2>
      <button (click)="closePasswordModal()" class="btn-icon">
        <lucide-angular [img]="XIcon" class="w-5 h-5"></lucide-angular>
      </button>
    </div>

    <form (ngSubmit)="changePassword()" class="p-6 space-y-4">
      <div>
        <label class="input-label">Mot de passe actuel</label>
        <input
          type="password"
          [(ngModel)]="passwordForm().currentPassword"
          name="currentPassword"
          required
          class="input-field"
          placeholder="••••••••"
        />
      </div>

      <div>
        <label class="input-label">Nouveau mot de passe</label>
        <input
          type="password"
          [(ngModel)]="passwordForm().newPassword"
          name="newPassword"
          required
          minlength="8"
          class="input-field"
          placeholder="••••••••"
        />
        <p class="text-xs text-dark-600 mt-1">Minimum 8 caractères</p>
      </div>

      <div>
        <label class="input-label">Confirmer le mot de passe</label>
        <input
          type="password"
          [(ngModel)]="passwordForm().confirmPassword"
          name="confirmPassword"
          required
          class="input-field"
          placeholder="••••••••"
        />
      </div>

      <div class="flex gap-3 pt-4">
        <button type="button" (click)="closePasswordModal()" class="btn-secondary flex-1">
          Annuler
        </button>
        <button type="submit" class="btn-primary flex-1">
          Changer
        </button>
      </div>
    </form>
  </div>
</div>