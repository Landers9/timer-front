<!-- src/app/pages/dashboard/dashboard.component.html -->
<div class="space-y-6 animate-fade-in max-w-[1600px] mx-auto">
  <!-- Header: Date, Time Tracker & Filters -->
  <div class="flex flex-col gap-4">
    <!-- Date & Time Tracker -->
    <div
      class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"
    >
      <div>
        <h2 class="text-3xl font-semibold text-dark-900 mb-1">Today</h2>
        <p class="text-sm text-dark-600">
          {{ formatDate(currentDate()) }} | {{ formatTime(currentDate()) }}
        </p>
      </div>

      <button
        (click)="toggleTimeTracker()"
        [class.bg-error]="isTracking()"
        [class.hover:bg-red-600]="isTracking()"
        [class.bg-primary-500]="!isTracking()"
        [class.hover:bg-primary-600]="!isTracking()"
        class="btn w-full lg:w-auto px-8 py-3 text-dark-900 font-semibold shadow-sm"
      >
        <lucide-angular
          [name]="isTracking() ? 'pause-circle' : 'play'"
          [size]="20"
        ></lucide-angular>
        <span>{{ isTracking() ? "Stop Tracking" : "Start Tracking" }}</span>
      </button>
    </div>

    <!-- Filters -->
    <div class="card">
      <div class="flex flex-col sm:flex-row gap-3">
        <!-- Period Filter (Everyone) -->
        <div class="flex-1">
          <label class="input-label">Period</label>
          <div class="flex gap-2">
            @for (period of periods; track period) {
            <button
              (click)="onPeriodChange(period)"
              [class.bg-primary-500]="selectedPeriod() === period"
              [class.text-dark-900]="selectedPeriod() === period"
              [class.bg-gray-100]="selectedPeriod() !== period"
              [class.text-dark-600]="selectedPeriod() !== period"
              class="btn text-xs px-4 py-2 capitalize"
            >
              {{ period }}
            </button>
            }
          </div>
        </div>

        <!-- Team & User Filters (Manager only) -->
        @if (isManager()) {
        <div class="flex-1">
          <label class="input-label">Team</label>
          <select (change)="onTeamChange($event)" class="input-field">
            <option value="">All Teams</option>
            @for (team of teams(); track team.id) {
            <option [value]="team.id">{{ team.name }}</option>
            }
          </select>
        </div>

        <div class="flex-1">
          <label class="input-label">User</label>
          <select
            (change)="onUserChange($event)"
            [disabled]="!selectedTeam()"
            class="input-field"
          >
            <option value="">All Users</option>
            @for (user of users(); track user.id) {
            <option [value]="user.id">{{ user.name }}</option>
            }
          </select>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
    <div class="card-stat">
      <div class="min-w-0 flex-1">
        <h3 class="text-xs font-medium text-dark-500 mb-1">Hours Worked</h3>
        <p class="text-2xl font-semibold text-dark-900">
          {{ stats().hoursWorked }}h
        </p>
      </div>
      <div class="stat-icon-bg">
        <lucide-angular name="clock" [size]="22"></lucide-angular>
      </div>
    </div>

    <div class="card-stat">
      <div class="min-w-0 flex-1">
        <h3 class="text-xs font-medium text-dark-500 mb-1">Pauses Taken</h3>
        <p class="text-2xl font-semibold text-dark-900">
          {{ stats().pausesTaken }}
        </p>
      </div>
      <div class="stat-icon-bg">
        <lucide-angular name="coffee" [size]="22"></lucide-angular>
      </div>
    </div>

    <div class="card-stat">
      <div class="min-w-0 flex-1">
        <h3 class="text-xs font-medium text-dark-500 mb-1">Avg Arrival</h3>
        <p class="text-2xl font-semibold text-dark-900">
          {{ stats().avgArrival }}
        </p>
      </div>
      <div class="stat-icon-bg">
        <lucide-angular name="log-in" [size]="22"></lucide-angular>
      </div>
    </div>

    <div class="card-stat">
      <div class="min-w-0 flex-1">
        <h3 class="text-xs font-medium text-dark-500 mb-1">Avg Departure</h3>
        <p class="text-2xl font-semibold text-dark-900">
          {{ stats().avgDeparture }}
        </p>
      </div>
      <div class="stat-icon-bg">
        <lucide-angular name="log-out" [size]="22"></lucide-angular>
      </div>
    </div>

    <div class="card-stat">
      <div class="min-w-0 flex-1">
        <h3 class="text-xs font-medium text-dark-500 mb-1">Attendance Rate</h3>
        <p class="text-2xl font-semibold text-dark-900">
          {{ stats().attendanceRate }}%
        </p>
      </div>
      <div class="stat-icon-bg">
        <lucide-angular name="check" [size]="22"></lucide-angular>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Hours Worked Chart -->
    <div class="card">
      <div class="section-header">
        <h3 class="section-title">Hours Worked</h3>
        <button class="btn-icon">
          <lucide-angular name="ellipsis-vertical" [size]="18"></lucide-angular>
        </button>
      </div>
      <div class="h-64 relative">
        <canvas #hoursChart></canvas>
      </div>
    </div>

    <!-- Pause Duration Chart -->
    <div class="card">
      <div class="section-header">
        <h3 class="section-title">Pause Duration</h3>
        <button class="btn-icon">
          <lucide-angular name="ellipsis-vertical" [size]="18"></lucide-angular>
        </button>
      </div>
      <div class="h-64 relative">
        <canvas #pauseChart></canvas>
      </div>
    </div>
  </div>

  <!-- Weekly History Table -->
  <div class="card">
    <div class="section-header">
      <h3 class="section-title">Weekly History</h3>
      <button class="btn-secondary text-xs flex items-center gap-1 px-3 py-1">
        <lucide-angular name="download" [size]="16"></lucide-angular>
        <span>Export</span>
      </button>
    </div>

    <!-- Desktop Table -->
    <div class="hidden md:block overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-200">
            <th class="table-header text-left py-3">Day</th>
            <th class="table-header text-left py-3">Date</th>
            <th class="table-header text-left py-3">Clock In</th>
            <th class="table-header text-left py-3">Clock Out</th>
            <th class="table-header text-left py-3">Pause Start</th>
            <th class="table-header text-left py-3">Pause End</th>
            <th class="table-header text-right py-3">Total Hours</th>
            <th class="table-header text-center py-3">Status</th>
          </tr>
        </thead>
        <tbody>
          @for (record of weeklyHistory(); track record.id) {
          <tr
            class="border-b border-gray-100 hover:bg-gray-50 transition-colors"
          >
            <td class="py-3 text-sm font-medium text-dark-900">
              {{ getDayName(record.date) }}
            </td>
            <td class="py-3 text-sm text-dark-600">
              {{ record.date | date : "MMM dd, yyyy" }}
            </td>
            <td class="py-3 text-sm font-mono text-dark-700">
              {{ record.clockIn }}
            </td>
            <td class="py-3 text-sm font-mono text-dark-700">
              {{ record.clockOut }}
            </td>
            <td class="py-3 text-sm font-mono text-dark-700">
              {{ record.pauseStart || "-" }}
            </td>
            <td class="py-3 text-sm font-mono text-dark-700">
              {{ record.pauseEnd || "-" }}
            </td>
            <td
              class="py-3 text-sm font-semibold text-right {{
                getStatusColor(record.status)
              }}"
            >
              {{ record.totalHours }}h
            </td>
            <td class="py-3 text-center">
              <span
                class="inline-flex items-center px-2 py-1 text-xs font-medium rounded {{
                  getStatusBadge(record.status)
                }}"
              >
                {{ record.status }}
              </span>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Mobile Cards -->
    <div class="md:hidden space-y-3">
      @for (record of weeklyHistory(); track record.id) {
      <div class="border border-gray-200 rounded p-4 space-y-2">
        <div class="flex items-center justify-between mb-2">
          <div>
            <p class="font-semibold text-sm text-dark-900">
              {{ getDayName(record.date) }}
            </p>
            <p class="text-xs text-dark-500">
              {{ record.date | date : "MMM dd, yyyy" }}
            </p>
          </div>
          <span
            class="inline-flex items-center px-2 py-1 text-xs font-medium rounded {{
              getStatusBadge(record.status)
            }}"
          >
            {{ record.status }}
          </span>
        </div>

        <div class="grid grid-cols-2 gap-2 text-xs">
          <div>
            <span class="text-dark-500">Clock In:</span>
            <p class="font-mono text-dark-900">{{ record.clockIn }}</p>
          </div>
          <div>
            <span class="text-dark-500">Clock Out:</span>
            <p class="font-mono text-dark-900">{{ record.clockOut }}</p>
          </div>
          <div>
            <span class="text-dark-500">Pause Start:</span>
            <p class="font-mono text-dark-900">
              {{ record.pauseStart || "-" }}
            </p>
          </div>
          <div>
            <span class="text-dark-500">Pause End:</span>
            <p class="font-mono text-dark-900">{{ record.pauseEnd || "-" }}</p>
          </div>
        </div>

        <div class="pt-2 border-t border-gray-100">
          <span class="text-dark-500 text-xs">Total Hours:</span>
          <p class="font-semibold {{ getStatusColor(record.status) }}">
            {{ record.totalHours }}h
          </p>
        </div>
      </div>
      }
    </div>
  </div>
</div>
